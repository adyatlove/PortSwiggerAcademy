Перейдем на уязвимый ресурс

откроем вкладку `live chat`

Попробуем внедрить XSS инъекцию в поле `message` введя туда
```
<img src=1 onerror='alert(1)'>
```
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/18.%20WebSockets/2.%20Manipulating%20the%20WebSocket%20handshake%20to%20exploit%20vulnerabilities/pics%20for%20walkthrough/1.png)

и увидим, что система распознала вредоносную активность и выкинула нас из сессии
```
Attack detected: Event handler
```
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/18.%20WebSockets/2.%20Manipulating%20the%20WebSocket%20handshake%20to%20exploit%20vulnerabilities/pics%20for%20walkthrough/2.png)

И даже по запросам внутри `Proxy` -> `WebSocket history` увидим, что он так же все экранировал
```
{"message":"&lt;img src=1 onerror=&#39;alert(1)&#39;&gt;&#x0a;"}
```
А при обновлении страницы с чатом появляется надпись
```
"This address is blacklisted"
```
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/18.%20WebSockets/2.%20Manipulating%20the%20WebSocket%20handshake%20to%20exploit%20vulnerabilities/pics%20for%20walkthrough/3.png)

Снова попробуем установить соединение с вебсокетом

И добавим в connect Header `X-forwarded-for: 1.1.1.1`

![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/18.%20WebSockets/2.%20Manipulating%20the%20WebSocket%20handshake%20to%20exploit%20vulnerabilities/pics%20for%20walkthrough/6.png)

Вернемся в `websocket` 
ввдем несуразицу формата 
```
{"message":"<img src=1 oNeRrOr=alert`1`>"}
```
и получим уведомление об успешно выполненной лабораторной работе
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/18.%20WebSockets/2.%20Manipulating%20the%20WebSocket%20handshake%20to%20exploit%20vulnerabilities/pics%20for%20walkthrough/7.png)
